/* qing-uploader v1.0.0 | (c) Mycolorway Design | MIT License */
!function(e,t){"object"==typeof module&&module.exports?module.exports=t(require("jquery"),require("qing-module")):e.QingUploader=t(e.jQuery,e.QingModule)}(this,function(e,t){var i=require=function e(t,i,r){function n(l,u){if(!i[l]){if(!t[l]){var s="function"==typeof require&&require;if(!u&&s)return s(l,!0);if(o)return o(l,!0);var a=new Error("Cannot find module '"+l+"'");throw a.code="MODULE_NOT_FOUND",a}var p=i[l]={exports:{}};t[l][0].call(p.exports,function(e){var i=t[l][1][e];return n(i?i:e)},p,p.exports,e,t,i,r)}return i[l].exports}for(var o="function"==typeof require&&require,l=0;l<r.length;l++)n(r[l]);return n}({"qing-uploader":[function(i,r,n){var o,l=function(e,t){function i(){this.constructor=e}for(var r in t)u.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},u={}.hasOwnProperty;o=function(t){function i(t){i.__super__.constructor.apply(this,arguments),this.opts=e.extend({},i.opts,t),this._locales=e.extend({},i.locales,this.opts.locales),this.files=[],this.queue=[],this.uploading=!1,this.id=++i.count,this.opts.el&&this._initFileField(this.opts.el),this._bind()}return l(i,t),i.count=0,i.opts={el:null,multiple:!0,fileFormat:null,url:"",params:null,fileKey:"upload_file",connectionCount:3,locales:null},i.locales={leaveConfirm:"There is file being uploaded, are you sure to leave this page?"},i.prototype._initFileField=function(t){var i,r;if(i=e(t),i.length>0)return r=i.find("input:file"),r.length>0&&r.remove(),r=e('<input type="file">').appendTo(i),this.opts.multiple&&r.attr("multiple",""),this.opts.fileFormat&&r.attr("accept",this.opts.fileFormat),r.on("change",function(e){return function(t){return e.upload(r[0].files),e._initFileField(i)}}(this)),this.field=r},i.prototype._bind=function(){return this.on("uploadcomplete",function(t){return function(i,r){return t.files.splice(e.inArray(r,t.files),1),t.queue.length>0&&t.files.length<t.opts.connectionCount?t.upload(t.queue.shift()):0===t.files.length?t.uploading=!1:void 0}}(this)),e(window).on("beforeunload.uploader-"+this.id,function(e){return function(t){if(e.uploading)return t.originalEvent.returnValue=e._locales.leaveConfirm,e._locales.leaveConfirm}}(this))},i.prototype.generateFileId=function(){var e;return e=0,function(){return e+=1}}(),i.prototype.upload=function(t,i){var r,n,o,l;if(null==i&&(i={}),null!=t)if(e.isArray(t)||t instanceof FileList)for(n=0,l=t.length;n<l;n++)r=t[n],this.upload(r,i);else if(e(t).is("input:file")?(o=e(t).attr("name"),o&&(i.fileKey=o),this.upload(e.makeArray(e(t)[0].files),i)):t.id&&t.obj||(t=this.getFile(t)),t&&t.obj){if(e.extend(t,i),this.files.length>=this.opts.connectionCount)return void this.queue.push(t);if(this.trigger("beforeupload",[t])!==!1)return this.files.push(t),this._xhrUpload(t),this.uploading=!0}},i.prototype.getFile=function(e){var t,i,r;return e instanceof window.File||e instanceof window.Blob?(t=null!=(i=e.fileName)?i:e.name,{id:this.generateFileId(),url:this.opts.url,params:this.opts.params,fileKey:this.opts.fileKey,name:t,size:null!=(r=e.fileSize)?r:e.size,ext:t?t.split(".").pop().toLowerCase():"",obj:e}):null},i.prototype._xhrUpload=function(t){var i,r,n,o;if(i=new FormData,i.append(t.fileKey,t.obj),i.append("original_filename",t.name),t.params){n=t.params;for(r in n)o=n[r],i.append(r,o)}return t.xhr=e.ajax({url:t.url,data:i,processData:!1,contentType:!1,type:"POST",headers:{"X-File-Name":encodeURIComponent(t.name)},xhr:function(){var t;return t=e.ajaxSettings.xhr(),t&&((t.upload||t).onprogress=function(t){return function(i){if(e.isFunction(t.progress))return t.progress(i)}}(this)),t},progress:function(e){return function(i){if(i.lengthComputable)return e.trigger("uploadprogress",[t,i.loaded,i.total])}}(this),error:function(e){return function(i,r,n){return e.trigger("uploaderror",[t,i,r])}}(this),success:function(e){return function(i){return e.trigger("uploadprogress",[t,t.size,t.size]),e.trigger("uploadsuccess",[t,i])}}(this),complete:function(e){return function(i,r){return e.trigger("uploadcomplete",[t,i.responseText])}}(this)})},i.prototype.cancel=function(t){var i,r,n,o;if(!t.id)for(o=this.files,r=0,n=o.length;r<n;r++)if(i=o[r],i.id===1*t){t=i;break}return t.xhr&&t.xhr.abort(),t.xhr=null,this.files.splice(e.inArray(t,this.files),1),0===this.files.length&&(this.uploading=!1),this.trigger("uploadcancel",[t]),t},i.prototype.readImageFile=function(t,i){var r,n;if(e.isFunction(i))return n=new Image,n.onload=function(){return i(n)},n.onerror=function(){return i(!1)},window.FileReader&&FileReader.prototype.readAsDataURL&&/^image/.test(t.type)?(r=new FileReader,r.onload=function(e){return n.src=e.target.result},r.readAsDataURL(t)):i(!1)},i.prototype.destroy=function(){var t,i,r,n;for(this.queue.length=0,n=this.files,i=0,r=n.length;i<r;i++)t=n[i],this.cancel(t);if(e(window).off(".uploader-"+this.id),this.field)return this.field.remove()},i}(t),r.exports=o},{}]},{},[]);return i("qing-uploader")});